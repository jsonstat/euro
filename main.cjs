// jsonstat-euro v1.0.5 Copyright 2019 Xavier Badosa https://jsonstat.com
"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var JSONstat=_interopDefault(require("jsonstat-toolkit")),version="1.0.5",ELANG="en",EVERSION="2.1";function hasProp(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function simpleQuery(e,t){var r=JSON.parse(JSON.stringify(e));return hasProp(r,"filter")&&(Object.keys(r.filter).forEach((function(e){r.filter[e]=r.filter[e].slice(0,1)})),!0===t&&(delete r.filter.time,r.filter.lastTimePeriod=["1"])),hasProp(r,"label")&&hasProp(r.label,"category")&&(Object.keys(r.label.category).forEach((function(e){r.label.category[e]=r.label.category[e].slice(0,1)})),!0===t&&delete r.label.category.time),r.class="query",r.lang=e.lang?e.lang:ELANG,r.version=e.version?e.version:EVERSION,r}function lastPeriodQuery(e){var t=JSON.parse(JSON.stringify(e));return hasProp(t,"filter")?(delete t.filter.time,t.filter.lastTimePeriod=["1"]):t.filter={lastTimePeriod:["1"]},t.class="query",t.lang=e.lang?e.lang:ELANG,t.version=e.version?e.version:EVERSION,t}function querify(e,t,r){return{class:"query",dataset:null,filter:e,lang:t||ELANG,version:r||EVERSION}}function addParamQuery(e,t,r){void 0===r&&(r=Object.keys(t),t=querify(t));var a=JSON.parse(JSON.stringify(e)),o=hasProp(t,"filter"),n=hasProp(t,"label")&&hasProp(t.label,"category");return r.forEach((function(e){o&&hasProp(t.filter,e)&&(hasProp(a,"filter")||(a.filter={}),a.filter[e]=t.filter[e]),n&&hasProp(t.label.category,e)&&(hasProp(a,"label")?hasProp(a.label,"category")||(a.label.category={}):a.label={},a.label.category[e]=t.label.category[e])})),a.class="query",a.lang=e.lang?e.lang:ELANG,a.version=e.version?e.version:EVERSION,a}function removeParamQuery(e,t){var r=JSON.parse(JSON.stringify(e)),a=hasProp(r,"filter"),o=hasProp(r,"label"),n=o&&hasProp(r.label,"category"),s=o&&hasProp(r.label,"dimension");return t.forEach((function(e){a&&delete r.filter[e],o&&(n&&delete r.label.category[e],s&&delete r.label.dimension[e])})),r.class="query",r.lang=e.lang?e.lang:ELANG,r.version=e.version?e.version:EVERSION,r}function removeTimeQuery(e){return removeParamQuery(e,["time","lastTimePeriod","sinceTimePeriod"])}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function getURL(e){if("string"==typeof e){if(/https?:\/\//i.test(e))return e;e={dataset:e}}if("object"===_typeof(e)&&null!==e&&!Array.isArray(e)&&e.dataset){var t=e.filter||null,r=e.lang||ELANG,a=e.version||EVERSION,o="".concat("https://ec.europa.eu/eurostat/wdds/rest/data/","v").concat(a,"/json/").concat(r,"/").concat(e.dataset),n=[];return t&&(Object.keys(t).forEach((function(e){var r=t[e];Array.isArray(r)?r.forEach((function(t){n.push("".concat(e,"=").concat(t))})):n.push("".concat(e,"=").concat(r))})),o+="?"+n.join("&")),o}return null}function setRole(e){e.role={geo:[],time:[],metric:[],classification:[]},e.id.forEach((function(t){switch(e.Dimension(t).role="time"===t||"geo"===t?t:"classification",t){case"geo":case"time":e.role[t].push(t);break;case"unit":case"s_adj":e.role.metric.push(t);break;default:e.role.classification.push(t)}}))}function fetchDataset(e){if(e)return JSONstat(getURL(e)).then((function(e){return"dataset"===e.class?(setRole(e),e):e}),(function(e){var t=e.message.slice(0,3),r=isNaN(t)?"418":t;return{class:"error",status:r,label:"418"!==r?e.message.slice(4):e.message}}))}function fetchQuery(e,t){"string"==typeof e&&(e={dataset:e});var r=!1!==t?lastPeriodQuery(e):e;return fetchDataset(r).then((function(e){if("error"===e.class)return e;var t={},a={},o={};return e.id.forEach((function(r){var n=e.Dimension(r);a[r]=n.label,t[r]=n.id,o[r]=n.Category().map((function(e){return e.label}))})),{class:"query",dataset:r.dataset,filter:t,label:{dataset:e.label,dimension:a,category:o},lang:r.lang||ELANG,version:r.version||EVERSION}}))}function fetchFullQuery(e){"string"==typeof e&&(e={dataset:e});var t=hasProp(e,"filter")?e.filter:null;if(t){var r=Object.keys(t);return fetchQuery(addParamQuery(e,t),!1).then((function(e){return"error"===e.class?e:fetchQuery(removeParamQuery(simpleQuery(e),r),!1).then((function(t){return"error"===t.class?t:addParamQuery(e,t,r)}))}))}return fetchQuery(e,!1).then((function(e){return e}))}function getStatusLabel(e,t){return e.extension.status.label[t]}function getEmptyDataset(e){var t=hasProp(e,"lang")?e.lang:ELANG,r=hasProp(e,"dataset")?e.dataset:null,a={lang:t.toUpperCase(),datasetId:r},o=Object.keys(e.filter),n=o.map((function(t){return e.filter[t].length})),s={};o.forEach((function(t){s[t]={label:e.label.dimension[t],category:{index:e.filter[t],label:{}}},e.filter[t].forEach((function(r,a){Object.defineProperty(s[t].category.label,r,{value:e.label.category[t][a]})}))}));var l={version:"2.0",class:"dataset",label:e.label.dataset,extension:a,id:o,size:n,dimension:s,value:[]},i=JSONstat(l);return setRole(i),i}exports.addParamQuery=addParamQuery,exports.fetchDataset=fetchDataset,exports.fetchFullQuery=fetchFullQuery,exports.fetchQuery=fetchQuery,exports.getEmptyDataset=getEmptyDataset,exports.getStatusLabel=getStatusLabel,exports.getURL=getURL,exports.lastPeriodQuery=lastPeriodQuery,exports.removeParamQuery=removeParamQuery,exports.removeTimeQuery=removeTimeQuery,exports.setRole=setRole,exports.simpleQuery=simpleQuery,exports.version=version;
