// jsonstat-euro v1.0.6 Copyright 2019 Xavier Badosa https://jsonstat.com
import e from"jsonstat-toolkit";var t="1.0.6";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a="en",n="2.1";function l(e){var t=e.lang||a,l=e.version||n,i=e.dataset||null,o=e.filter||null,c=e.label||null,s={class:"query",lang:t,version:l,dataset:i};return o&&"object"===r(o)&&0!==Object.keys(o).length&&(Object.keys(o).forEach((function(e){var t=o[e];Array.isArray(t)||(o[e]=[t]),0===o[e].length&&delete o[e]})),s.filter=o),c&&"object"===r(c)&&0!==Object.keys(c).length&&(s.label=c),s}function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function o(e,t){var r=JSON.parse(JSON.stringify(e));return i(r,"filter")&&(Object.keys(r.filter).forEach((function(e){r.filter[e]=r.filter[e].slice(0,1)})),!0===t&&(delete r.filter.time,r.filter.lastTimePeriod=["1"])),i(r,"label")&&i(r.label,"category")&&(Object.keys(r.label.category).forEach((function(e){r.label.category[e]=r.label.category[e].slice(0,1)})),!0===t&&delete r.label.category.time),l(r)}function c(e){var t=JSON.parse(JSON.stringify(e));return i(t,"filter")?(delete t.filter.time,t.filter.lastTimePeriod=["1"]):t.filter={lastTimePeriod:["1"]},l(t)}function s(e,t,r){void 0===r&&(r=Object.keys(t),t=l({dataset:null,filter:t}));var a=JSON.parse(JSON.stringify(e)),n=i(t,"filter"),o=i(t,"label")&&i(t.label,"category");return r.forEach((function(e){n&&i(t.filter,e)&&(i(a,"filter")||(a.filter={}),a.filter[e]=t.filter[e]),o&&i(t.label.category,e)&&(i(a,"label")?i(a.label,"category")||(a.label.category={}):a.label={},a.label.category[e]=t.label.category[e])})),l(a)}function f(e,t){var r=JSON.parse(JSON.stringify(e)),a=i(r,"filter"),n=i(r,"label"),o=n&&i(r.label,"category"),c=n&&i(r.label,"dimension");return t.forEach((function(e){a&&delete r.filter[e],n&&(o&&delete r.label.category[e],c&&delete r.label.dimension[e])})),l(r)}function u(e){return f(e,["time","lastTimePeriod","sinceTimePeriod"])}function b(e){if("string"==typeof e){if(/https?:\/\//i.test(e))return e;e={dataset:e}}if("object"===r(e)&&null!==e&&!Array.isArray(e)&&e.dataset){e=l(e);var t="".concat("https://ec.europa.eu/eurostat/wdds/rest/data/","v").concat(e.version,"/json/").concat(e.lang,"/").concat(e.dataset),a=[],n=e.filter||null;return n&&0!==Object.keys(n).length&&(Object.keys(n).forEach((function(e){n[e].forEach((function(t){a.push("".concat(e,"=").concat(t))}))})),t+="?"+a.join("&")),t}return null}function y(e){e.role={geo:[],time:[],metric:[],classification:[]},e.id.forEach((function(t){switch(e.Dimension(t).role="time"===t||"geo"===t?t:"classification",t){case"geo":case"time":e.role[t].push(t);break;case"unit":case"s_adj":e.role.metric.push(t);break;default:e.role.classification.push(t)}}))}function d(t){if(t)return e(b(t)).then((function(e){return"dataset"===e.class?(y(e),e):e}),(function(e){var t=e.message.slice(0,3),r=isNaN(t)?"418":t;return{class:"error",status:r,label:"418"!==r?e.message.slice(4):e.message}}))}function g(e,t){"string"==typeof e&&(e={dataset:e});var r=!1!==t?c(e):e;return d(r).then((function(e){if("error"===e.class)return e;var t={},l={},i={};return e.id.forEach((function(r){var a=e.Dimension(r);l[r]=a.label,t[r]=a.id,i[r]=a.Category().map((function(e){return e.label}))})),{class:"query",dataset:r.dataset,filter:t,label:{dataset:e.label,dimension:l,category:i},lang:r.lang||a,version:r.version||n}}))}function m(e){"string"==typeof e&&(e={dataset:e});var t=i(e,"filter")?e.filter:null;if(t&&0!==Object.keys(t).length){var r=Object.keys(t);return g(s(e,t),!1).then((function(e){return"error"===e.class?e:g(f(o(e),r),!1).then((function(t){return"error"===t.class?t:s(e,t,r)}))}))}return g(e,!1).then((function(e){return e}))}function p(e,t){return e.extension.status.label[t]}function h(t){var r=i(t,"lang")?t.lang:a,n=i(t,"dataset")?t.dataset:null,l={lang:r.toUpperCase(),datasetId:n},o=Object.keys(t.filter),c=o.map((function(e){return t.filter[e].length})),s={};o.forEach((function(e){s[e]={label:t.label.dimension[e],category:{index:t.filter[e],label:{}}},t.filter[e].forEach((function(r,a){Object.defineProperty(s[e].category.label,r,{value:t.label.category[e][a]})}))}));var f={version:"2.0",class:"dataset",label:t.label.dataset,extension:l,id:o,size:c,dimension:s,value:[]},u=e(f);return y(u),u}export{s as addParamQuery,d as fetchDataset,m as fetchFullQuery,g as fetchQuery,h as getEmptyDataset,p as getStatusLabel,b as getURL,c as lastPeriodQuery,f as removeParamQuery,u as removeTimeQuery,y as setRole,o as simpleQuery,t as version};
